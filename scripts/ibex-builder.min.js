$(function(){$('#calStartDate').datepicker({dateFormat:'yy-mm-dd',onSelect:function(dateText,inst){ibexBuilder.GetData(dateText);},showOn:'both',buttonImage:'dashboard-icon.gif',buttonImageOnly:true});ibexBuilder.GetData(ibexBuilder.StartOffsetDays);});ibexBuilder.Initialise=function()
{this.dow=new Array('Sun','Mon','Tue','Wed','Thu','Fri','Sat');this.months=new Array('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');this.htmlTable='<table class="calendarTable" border="1" cellpadding="3" cellspacing="0" bordercolor="#FFFFFF" width="100%">';this.htmlHdrRow='<tr class="header">';this.htmlHdrColName='<td width="{ColWidths.Name}">Tour</td>';this.htmlHdrColDay='<td width="{ColWidths.Days}" class="center">{DateDow}<br>{DateText}</td>';this.htmlRow='<tr class="{OddEven}row">';this.htmlColName='<td class="property-rate">{PropertyDetails}<br><i>{LocationDetails}{RegionDetails}</i></td>';this.htmlColDaySold='<td class="sold">-</td>';this.htmlColDayAvail='<td class="{AvailClass}_{OddEven}">{DayDetails}</td>';this.htmlPropertyDetails='<a class="addToolTip" title="<div id=\'ToolTipTextWrap\'>{tipPropertyName}</div>{PropertyDesc}"><b>{PropertyName}</b></a>';this.htmlLocationDetails='<a class="addToolTip" title="<div id=\'ToolTipTextWrap\'>{tipLocationName}</div>{LocationDesc}">{LocationName}</a>';this.htmlRegionDetails='<a class="addToolTip" title="<div id=\'ToolTipTextWrap\'>{tipRegionName}</div>{RegionDesc}">{RegionName}</a>'
this.htmlDayDetails='<a onclick="ibexBuilder.GoToPage({PropertyId}, \'{DateYmd}\', {MinStay}, \'{CustomUrl}\')"'+'class="addToolTip" title="<div id=\'ToolTipTextWrap\'>Click to book</div><p>{AvailabilityInfo}</p>">{TourRate}</a>';document.getElementById('calendarPrev').innerHTML='&lt;&lt; Prev '+ibexBuilder.NoOfDays+' Days';document.getElementById('calendarNext').innerHTML='Next '+ibexBuilder.NoOfDays+' Days &gt;&gt;';}
ibexBuilder.OnError=function(error)
{document.getElementById("calendarBusy").style.display="none";alert(error);}
ibexBuilder.ShowBusy=function()
{document.getElementById("calendarBusy").style.display="inline";var calendarContent=document.getElementById('calendarContent');calendarContent.setAttribute('class','content-busy');}
ibexBuilder.PrevPeriod=function()
{this.GetData(-this.NoOfDays);}
ibexBuilder.NextPeriod=function()
{this.GetData(this.NoOfDays);}
ibexBuilder.GoToPage=function(propertyId,stDate,minStay,customUrl)
{var endDate=new Date(this.DateFromString(stDate));endDate.setDate(endDate.getDate()+minStay);var sep,url,target=this.TargetWindow;if(customUrl=='')
{sep=this.TargetUrl.indexOf('?')<0?'?':'&';url=this.TargetUrl+sep+'op='+this.OperatorId+'&pid='+propertyId+
(this.TargetRegUserId!=''?('&ru='+this.TargetRegUserId):'')+'&datein='+stDate+'&dateout='+this.DateToString(endDate);}
else{sep=customUrl.indexOf('?')<0?'?':'&';url=customUrl+sep+'datein='+stDate+'&dateout='+this.DateToString(endDate);target='_blank';}
if(this.TargetSafariFix!=''){var redirectURL=encodeURIComponent(url);var url=this.TargetSafariFix+'?url='+redirectURL;}
var newWindow=window.open(url,target);try
{newWindow.focus();}
catch(e){}}
ibexBuilder.Build=function(data)
{if(this.htmlTable==null)this.Initialise();this.StartDate=data.StartDate;this.EndDate=data.EndDate;document.getElementById('calStartDate').value=this.DateToString(this.StartDate);var html=this.htmlTable+
this.htmlHdrRow;if(this.ShowPropertyName)html+=this.htmlHdrColName.replace("{ColWidths.Name}",this.ColWidths.Name);var day=new Date(this.StartDate);for(var dayCt=0;dayCt<this.NoOfDays;dayCt++)
{var dateText='0'+day.getDate();dateText=dateText.substr(dateText.length-2)+' '+this.months[day.getMonth()];html+=this.htmlHdrColDay.replace("{ColWidths.Days}",this.ColWidths.Days).replace("{DateDow}",this.dow[day.getDay()]).replace("{DateText}",dateText);day.setDate(day.getDate()+1);}
var rowNo=0,oddEven=new Array('odd','even');for(var propKey=0;propKey<data.Properties.length;propKey++)
{var propHtml='';var hasAvailability=false;var property=data.Properties[propKey];var propDesc=property.LeadIn!=''?property.LeadIn:(property.PromoText!=''?property.PromoText:property.DescSummary);var propName=propInfo==''?property.Name:this.htmlPropertyDetails.replace("{PropertyDesc}",propDesc).replace("{PropertyName}",property.Name).replace("{tipPropertyName}",property.Name);var locnHtml=(this.ShowLocationName?property.Location:'');var rgionHtml=(this.ShowLocationName?(locnHtml?', '+property.Region:property.Region):'');if(this.ShowPropertyName){propHtml+=this.htmlColName.replace("{PropertyDetails}",propName).replace("{LocationDetails}",locnHtml).replace("{RegionDetails}",rgionHtml);}
for(var rateKey=0;rateKey<property.MinRates.length;rateKey++)
{var minRateDay=property.MinRates[rateKey];if(!this.HideUnavailable){hasAvailability=true;}
if(minRateDay.Status=='Unavailable')propHtml+=this.htmlColDaySold;else
{hasAvailability=true;var availClass=minRateDay.Status=='Instant Confirmation'?'available':'onreq';var availInfo='Tour Type  - '+minRateDay.RoomName+'<br>'+'Rate Name - '+minRateDay.RateName+'<br>';if(this.AvailabilityAlertThreshold>0&&this.AvailabilityAlertMessage!=''&&minRateDay.TotalAvailable<=this.AvailabilityAlertThreshold)
{availInfo=this.AvailabilityAlertMessage+'<br>'+availInfo;}
var roomRate=data.CurrencySymbol+Math.round(parseInt(minRateDay.MinRate));var dayDetails=this.htmlDayDetails.replace("{PropertyId}",property.Id);dayDetails=dayDetails.replace("{DateYmd}",minRateDay.Date).replace("{MinStay}",minRateDay.MinStay);dayDetails=dayDetails.replace("{CustomUrl}",property.CustomUrl);dayDetails=dayDetails.replace("{AvailabilityInfo}",availInfo).replace("{TourRate}",roomRate);propHtml+=this.htmlColDayAvail.replace("{AvailClass}",availClass).replace("{DayDetails}",dayDetails);}}
if(hasAvailability){var rowType=oddEven[rowNo++%2];html+='</tr>'+this.htmlRow.replace("{OddEven}",rowType)+propHtml.replace("{OddEvent}",rowType);}}
html+='</tr></table>';var calendarContent=document.getElementById('calendarContent');var colorScheme=(typeof this.CustomColorScheme==='undefined'||this.CustomColorScheme===''?'navy':this.CustomColorScheme);calendarContent.innerHTML=html+'<div class="loading-calendar"></div>';calendarContent.setAttribute('class',colorScheme.toLowerCase());addwarning();document.getElementById("calendarBusy").style.display="none";iframeResizePipe();}
function iframeResizePipe()
{var height=document.body.scrollHeight;var pipe=document.getElementById('ibex-frame');pipe.src=ibexBuilder.ibexHelper+'?height='+height+'&cacheb='+Math.random();}